<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrator Portal - FOMD Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(to right, #2c3e50, #4a5f7a);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-bottom: 5px solid #95a5a6;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .company-name {
            font-size: 1.8rem;
            font-weight: 300;
            margin-bottom: 10px;
            color: #ecf0f1;
        }

        .portal-title {
            font-size: 2.5rem;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .department-name {
            font-size: 1.4rem;
            font-weight: 300;
            margin-top: 10px;
            color: #bdc3c7;
        }

        .admin-badge {
            background-color: #e74c3c;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
            display: inline-block;
        }

        .breadcrumb {
            background-color: #ecf0f1;
            padding: 10px 20px;
            margin: 20px 0;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        main {
            padding: 20px 0;
        }

        .page-title {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #bdc3c7;
        }

        .admin-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .personnel-count {
            background-color: #34495e;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .status-summary {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-active { background-color: #2ecc71; color: white; }
        .status-resigned { background-color: #e67e22; color: white; }
        .status-retired { background-color: #3498db; color: white; }
        .status-terminated { background-color: #e74c3c; color: white; }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .primary-btn {
            background-color: #3498db;
            color: white;
        }

        .primary-btn:hover {
            background-color: #2980b9;
        }

        .secondary-btn {
            background-color: #95a5a6;
            color: white;
        }

        .secondary-btn:hover {
            background-color: #7f8c8d;
        }

        .success-btn {
            background-color: #2ecc71;
            color: white;
        }

        .success-btn:hover {
            background-color: #27ae60;
        }

        .danger-btn {
            background-color: #e74c3c;
            color: white;
        }

        .danger-btn:hover {
            background-color: #c0392b;
        }

        .warning-btn {
            background-color: #f39c12;
            color: white;
        }

        .warning-btn:hover {
            background-color: #e67e22;
        }

        .form-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: none;
        }

        .form-container.active {
            display: block;
        }

        .form-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ecf0f1;
        }

        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .form-group {
            margin-bottom: 15px;
            flex: 1;
            min-width: 200px;
        }

        .form-group.full-width {
            flex: 1 0 100%;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .other-position-input {
            margin-top: 5px;
            display: none;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .table-container {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        th {
            background-color: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 500;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .edit-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.3s;
        }

        .edit-btn:hover {
            background-color: #2980b9;
        }

        .delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.3s;
        }

        .delete-btn:hover {
            background-color: #c0392b;
        }

        .status-dropdown, .position-dropdown, .employment-status-dropdown {
            padding: 5px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 0.9rem;
            width: 100%;
        }

        .status-active { color: #2ecc71; font-weight: 500; }
        .status-resigned { color: #e67e22; font-weight: 500; }
        .status-retired { color: #3498db; font-weight: 500; }
        .status-terminated { color: #e74c3c; font-weight: 500; }

        .employment-regular { color: #2ecc71; font-weight: 500; }
        .employment-probationary { color: #f39c12; font-weight: 500; }
        .employment-contractual { color: #3498db; font-weight: 500; }

        .user-admin { color: #e74c3c; font-weight: 500; }
        .user-staff { color: #3498db; font-weight: 500; }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #bdc3c7;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #ecf0f1;
            border: 1px solid #bdc3c7;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
        }

        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        footer {
            background-color: #2c3e50;
            color: #ecf0f1;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .footer-logo {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .copyright {
            font-size: 0.9rem;
            color: #bdc3c7;
        }

        @media (max-width: 768px) {
            .footer-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .admin-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .btn-group {
                width: 100%;
            }
            
            .btn {
                flex: 1;
                text-align: center;
            }
            
            th, td {
                padding: 8px 10px;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-group {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="company-name">International Pharmaceuticals Incorporated</div>
            <h1 class="portal-title">FOMD Portal</h1>
            <div class="department-name">Facilities Operation and Maintenance Department</div>
            <div class="admin-badge">Administrator Access</div>
        </div>
    </header>

    <div class="container">
        <div class="breadcrumb">
            <a href="index.html">FOMD Portal</a> &gt; 
            Administrator Portal
        </div>

        <main>
            <h1 class="page-title">Administrator Dashboard</h1>
            
            <div class="tabs">
                <div class="tab active" data-tab="personnel">Employee Management</div>
                <div class="tab" data-tab="users">User Accounts</div>
            </div>
            
            <!-- Employee Management Tab -->
            <div class="tab-content active" id="personnel-tab">
                <div class="admin-controls">
                    <div>
                        <div class="personnel-count">
                            Total Personnel: <span id="totalPersonnel">0</span>
                        </div>
                        <div class="status-summary" id="statusSummary">
                            <!-- Status summary will be populated dynamically -->
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn primary-btn" id="addEmployeeBtn">Add New Employee</button>
                        <a href="index.html" class="btn secondary-btn">Back to Portal</a>
                        <a href="staff-directory.html" class="btn secondary-btn">View Staff Directory</a>
                    </div>
                </div>

                <!-- Add/Edit Employee Form -->
                <div class="form-container" id="employeeForm">
                    <h2 class="form-title" id="formTitle">Add New Employee</h2>
                    <form id="employeeDataForm">
                        <input type="hidden" id="editIndex" value="">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="employeeName">Employee Name</label>
                                <input type="text" id="employeeName" required>
                            </div>
                            <div class="form-group">
                                <label for="employeeId">ID Number</label>
                                <input type="text" id="employeeId" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dateHired">Date Hired</label>
                                <input type="date" id="dateHired" required>
                            </div>
                            <div class="form-group">
                                <label for="employeeStatus">Status</label>
                                <select id="employeeStatus" required>
                                    <option value="ACTIVE">ACTIVE</option>
                                    <option value="RESIGNED">RESIGNED</option>
                                    <option value="RETIRED">RETIRED</option>
                                    <option value="TERMINATED">TERMINATED</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="currentPosition">Current Position</label>
                                <select id="currentPosition" required>
                                    <option value="">Select Position</option>
                                    <option value="Department Head">Department Head</option>
                                    <option value="Assistant Department Head">Assistant Department Head</option>
                                    <option value="Department Secretary">Department Secretary</option>
                                    <option value="Section Supervisor">Section Supervisor</option>
                                    <option value="Assistant Section Supervisor">Assistant Section Supervisor</option>
                                    <option value="Operator">Operator</option>
                                    <option value="Maintenance Technician">Maintenance Technician</option>
                                    <option value="Chemical Engineer">Chemical Engineer</option>
                                    <option value="Others">Others</option>
                                </select>
                                <input type="text" id="otherPosition" class="other-position-input" placeholder="Specify position">
                            </div>
                            <div class="form-group">
                                <label for="employmentStatus">Employment Status</label>
                                <select id="employmentStatus" required>
                                    <option value="Regular">Regular</option>
                                    <option value="Probationary">Probationary</option>
                                    <option value="Contractual">Contractual</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn secondary-btn" id="cancelEmployeeBtn">Cancel</button>
                            <button type="submit" class="btn success-btn">Save Employee</button>
                        </div>
                    </form>
                </div>

                <div class="table-container">
                    <table id="personnelTable">
                        <thead>
                            <tr>
                                <th width="20%">Employee Name</th>
                                <th width="12%">ID Number</th>
                                <th width="12%">Date Hired</th>
                                <th width="10%">Status</th>
                                <th width="18%">Current Position</th>
                                <th width="15%">Employment Status</th>
                                <th width="13%">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="personnelTableBody">
                            <!-- Table rows will be added dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- User Accounts Tab -->
            <div class="tab-content" id="users-tab">
                <div class="admin-controls">
                    <div>
                        <div class="personnel-count">
                            Total User Accounts: <span id="totalUsers">0</span>
                        </div>
                        <div class="status-summary" id="userTypeSummary">
                            <!-- User type summary will be populated dynamically -->
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn primary-btn" id="addUserBtn">Create New User</button>
                        <a href="index.html" class="btn secondary-btn">Back to Portal</a>
                    </div>
                </div>

                <!-- Add/Edit User Form -->
                <div class="form-container" id="userForm">
                    <h2 class="form-title" id="userFormTitle">Create New User Account</h2>
                    <form id="userDataForm">
                        <input type="hidden" id="userEditIndex" value="">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" required>
                            </div>
                            <div class="form-group">
                                <label for="fullName">Full Name</label>
                                <input type="text" id="fullName" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="password">Password</label>
                                <input type="password" id="password" required>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Confirm Password</label>
                                <input type="password" id="confirmPassword" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="userType">User Type</label>
                                <select id="userType" required>
                                    <option value="staff">Staff (Standard Access)</option>
                                    <option value="admin">Administrator (Full Access)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="userStatus">Account Status</label>
                                <select id="userStatus" required>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn secondary-btn" id="cancelUserBtn">Cancel</button>
                            <button type="submit" class="btn success-btn">Save User</button>
                        </div>
                    </form>
                </div>

                <div class="table-container">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th width="20%">Username</th>
                                <th width="20%">Full Name</th>
                                <th width="15%">User Type</th>
                                <th width="15%">Status</th>
                                <th width="15%">Last Login</th>
                                <th width="15%">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Table rows will be added dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">International Pharmaceuticals Incorporated</div>
                <div class="copyright">© 2023 FOMD Portal. All rights reserved.</div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab functionality
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show active tab content
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Employee Management Code
            const personnelTableBody = document.getElementById('personnelTableBody');
            const totalPersonnelElement = document.getElementById('totalPersonnel');
            const statusSummaryElement = document.getElementById('statusSummary');
            const addEmployeeBtn = document.getElementById('addEmployeeBtn');
            const employeeForm = document.getElementById('employeeForm');
            const formTitle = document.getElementById('formTitle');
            const employeeDataForm = document.getElementById('employeeDataForm');
            const cancelEmployeeBtn = document.getElementById('cancelEmployeeBtn');
            const editIndexInput = document.getElementById('editIndex');
            
            // Form fields
            const employeeNameInput = document.getElementById('employeeName');
            const employeeIdInput = document.getElementById('employeeId');
            const dateHiredInput = document.getElementById('dateHired');
            const employeeStatusInput = document.getElementById('employeeStatus');
            const currentPositionInput = document.getElementById('currentPosition');
            const otherPositionInput = document.getElementById('otherPosition');
            const employmentStatusInput = document.getElementById('employmentStatus');
            
            // Position options
            const positionOptions = [
                'Department Head',
                'Assistant Department Head',
                'Department Secretary',
                'Section Supervisor',
                'Assistant Section Supervisor',
                'Operator',
                'Maintenance Technician',
                'Chemical Engineer',
                'Others'
            ];
            
            // Employment status options
            const employmentStatusOptions = ['Regular', 'Probationary', 'Contractual'];
            
            // Load personnel data from localStorage or initialize with sample data
            let personnelData = JSON.parse(localStorage.getItem('fomdPersonnelData')) || [
                { 
                    name: 'John Smith', 
                    id: 'IPI-001', 
                    dateHired: '2020-03-15', 
                    status: 'ACTIVE',
                    position: 'Department Head',
                    employmentStatus: 'Regular'
                },
                { 
                    name: 'Maria Garcia', 
                    id: 'IPI-002', 
                    dateHired: '2019-07-22', 
                    status: 'ACTIVE',
                    position: 'Chemical Engineer',
                    employmentStatus: 'Regular'
                },
                { 
                    name: 'Robert Johnson', 
                    id: 'IPI-003', 
                    dateHired: '2021-11-05', 
                    status: 'ACTIVE',
                    position: 'Maintenance Technician',
                    employmentStatus: 'Regular'
                },
                { 
                    name: 'Sarah Williams', 
                    id: 'IPI-004', 
                    dateHired: '2018-05-12', 
                    status: 'RESIGNED',
                    position: 'Section Supervisor',
                    employmentStatus: 'Regular'
                },
                { 
                    name: 'Michael Brown', 
                    id: 'IPI-005', 
                    dateHired: '2022-02-28', 
                    status: 'ACTIVE',
                    position: 'Operator',
                    employmentStatus: 'Probationary'
                },
                { 
                    name: 'David Wilson', 
                    id: 'IPI-006', 
                    dateHired: '2023-01-15', 
                    status: 'ACTIVE',
                    position: 'Others',
                    positionOther: 'Safety Officer',
                    employmentStatus: 'Contractual'
                },
                { 
                    name: 'Jennifer Lee', 
                    id: 'IPI-007', 
                    dateHired: '2021-06-10', 
                    status: 'ACTIVE',
                    position: 'Department Secretary',
                    employmentStatus: 'Regular'
                }
            ];
            
            // User Management Code
            const usersTableBody = document.getElementById('usersTableBody');
            const totalUsersElement = document.getElementById('totalUsers');
            const userTypeSummaryElement = document.getElementById('userTypeSummary');
            const addUserBtn = document.getElementById('addUserBtn');
            const userForm = document.getElementById('userForm');
            const userFormTitle = document.getElementById('userFormTitle');
            const userDataForm = document.getElementById('userDataForm');
            const cancelUserBtn = document.getElementById('cancelUserBtn');
            const userEditIndexInput = document.getElementById('userEditIndex');
            
            // Form fields
            const usernameInput = document.getElementById('username');
            const fullNameInput = document.getElementById('fullName');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const userTypeInput = document.getElementById('userType');
            const userStatusInput = document.getElementById('userStatus');
            
            // Load user data from localStorage or initialize with default admin account
            let userData = JSON.parse(localStorage.getItem('fomdUserData')) || [
                {
                    username: 'admin',
                    fullName: 'System Administrator',
                    password: 'admin123', // In a real app, this would be hashed
                    userType: 'admin',
                    status: 'active',
                    lastLogin: null
                }
            ];
            
            // Save data to localStorage
            function saveData() {
                localStorage.setItem('fomdPersonnelData', JSON.stringify(personnelData));
                localStorage.setItem('fomdUserData', JSON.stringify(userData));
            }
            
            // Function to update status summary
            function updateStatusSummary() {
                const statusCounts = {
                    'ACTIVE': 0,
                    'RESIGNED': 0,
                    'RETIRED': 0,
                    'TERMINATED': 0
                };
                
                personnelData.forEach(person => {
                    statusCounts[person.status]++;
                });
                
                statusSummaryElement.innerHTML = '';
                
                for (const status in statusCounts) {
                    if (statusCounts[status] > 0) {
                        const badge = document.createElement('span');
                        badge.className = `status-badge status-${status.toLowerCase()}`;
                        badge.textContent = `${status}: ${statusCounts[status]}`;
                        statusSummaryElement.appendChild(badge);
                    }
                }
            }
            
            // Function to update user type summary
            function updateUserTypeSummary() {
                const userTypeCounts = {
                    'admin': 0,
                    'staff': 0
                };
                
                userData.forEach(user => {
                    if (user.status === 'active') {
                        userTypeCounts[user.userType]++;
                    }
                });
                
                userTypeSummaryElement.innerHTML = '';
                
                for (const userType in userTypeCounts) {
                    if (userTypeCounts[userType] > 0) {
                        const badge = document.createElement('span');
                        badge.className = `status-badge ${userType === 'admin' ? 'status-terminated' : 'status-active'}`;
                        badge.textContent = `${userType.toUpperCase()}: ${userTypeCounts[userType]}`;
                        userTypeSummaryElement.appendChild(badge);
                    }
                }
            }
            
            // Handle "Others" position selection
            currentPositionInput.addEventListener('change', function() {
                if (this.value === 'Others') {
                    otherPositionInput.style.display = 'block';
                    otherPositionInput.required = true;
                } else {
                    otherPositionInput.style.display = 'none';
                    otherPositionInput.required = false;
                    otherPositionInput.value = '';
                }
            });
            
            // Function to update the personnel table and count
            function updatePersonnelTable() {
                // Clear the table body
                personnelTableBody.innerHTML = '';
                
                // Add rows for each personnel
                personnelData.forEach((person, index) => {
                    const row = document.createElement('tr');
                    
                    // Name column
                    const nameCell = document.createElement('td');
                    nameCell.textContent = person.name;
                    
                    // ID column
                    const idCell = document.createElement('td');
                    idCell.textContent = person.id;
                    
                    // Date Hired column
                    const dateCell = document.createElement('td');
                    dateCell.textContent = formatDate(person.dateHired);
                    
                    // Status column with dropdown
                    const statusCell = document.createElement('td');
                    const statusSelect = document.createElement('select');
                    statusSelect.className = 'status-dropdown';
                    statusSelect.setAttribute('data-index', index);
                    
                    const statusOptions = ['ACTIVE', 'RESIGNED', 'RETIRED', 'TERMINATED'];
                    statusOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        if (option === person.status) {
                            optionElement.selected = true;
                        }
                        statusSelect.appendChild(optionElement);
                    });
                    
                    statusSelect.addEventListener('change', function() {
                        const idx = parseInt(this.getAttribute('data-index'));
                        personnelData[idx].status = this.value;
                        saveData();
                        updateStatusSummary();
                    });
                    
                    statusCell.appendChild(statusSelect);
                    
                    // Current Position column with dropdown
                    const positionCell = document.createElement('td');
                    const positionSelect = document.createElement('select');
                    positionSelect.className = 'position-dropdown';
                    positionSelect.setAttribute('data-index', index);
                    
                    positionOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        if (option === person.position) {
                            optionElement.selected = true;
                        }
                        positionSelect.appendChild(optionElement);
                    });
                    
                    positionSelect.addEventListener('change', function() {
                        const idx = parseInt(this.getAttribute('data-index'));
                        personnelData[idx].position = this.value;
                        if (this.value !== 'Others') {
                            delete personnelData[idx].positionOther;
                        }
                        saveData();
                    });
                    
                    positionCell.appendChild(positionSelect);
                    
                    // Employment Status column with dropdown
                    const employmentStatusCell = document.createElement('td');
                    const employmentStatusSelect = document.createElement('select');
                    employmentStatusSelect.className = 'employment-status-dropdown';
                    employmentStatusSelect.setAttribute('data-index', index);
                    
                    employmentStatusOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        if (option === person.employmentStatus) {
                            optionElement.selected = true;
                        }
                        employmentStatusSelect.appendChild(optionElement);
                    });
                    
                    employmentStatusSelect.addEventListener('change', function() {
                        const idx = parseInt(this.getAttribute('data-index'));
                        personnelData[idx].employmentStatus = this.value;
                        saveData();
                    });
                    
                    employmentStatusCell.appendChild(employmentStatusSelect);
                    
                    // Actions column
                    const actionsCell = document.createElement('td');
                    actionsCell.className = 'actions';
                    actionsCell.innerHTML = `
                        <button class="edit-btn" data-index="${index}">Edit</button>
                        <button class="delete-btn" data-index="${index}">Delete</button>
                    `;
                    
                    row.appendChild(nameCell);
                    row.appendChild(idCell);
                    row.appendChild(dateCell);
                    row.appendChild(statusCell);
                    row.appendChild(positionCell);
                    row.appendChild(employmentStatusCell);
                    row.appendChild(actionsCell);
                    
                    personnelTableBody.appendChild(row);
                });
                
                // Update personnel count
                totalPersonnelElement.textContent = personnelData.length;
                
                // Update status summary
                updateStatusSummary();
                
                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        editEmployee(index);
                    });
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        deleteEmployee(index);
                    });
                });
                
                // Save data after any update
                saveData();
            }
            
            // Function to update the users table and count
            function updateUsersTable() {
                // Clear the table body
                usersTableBody.innerHTML = '';
                
                // Add rows for each user
                userData.forEach((user, index) => {
                    const row = document.createElement('tr');
                    
                    // Username column
                    const usernameCell = document.createElement('td');
                    usernameCell.textContent = user.username;
                    
                    // Full Name column
                    const fullNameCell = document.createElement('td');
                    fullNameCell.textContent = user.fullName;
                    
                    // User Type column
                    const userTypeCell = document.createElement('td');
                    userTypeCell.innerHTML = `<span class="user-${user.userType}">${user.userType.toUpperCase()}</span>`;
                    
                    // Status column
                    const statusCell = document.createElement('td');
                    statusCell.innerHTML = `<span class="status-${user.status === 'active' ? 'active' : 'resigned'}">${user.status.toUpperCase()}</span>`;
                    
                    // Last Login column
                    const lastLoginCell = document.createElement('td');
                    lastLoginCell.textContent = user.lastLogin ? formatDate(user.lastLogin) : 'Never';
                    
                    // Actions column
                    const actionsCell = document.createElement('td');
                    actionsCell.className = 'actions';
                    
                    // Don't allow deletion of the last admin account
                    const isLastAdmin = user.userType === 'admin' && 
                        userData.filter(u => u.userType === 'admin' && u.status === 'active').length === 1;
                    
                    actionsCell.innerHTML = `
                        <button class="edit-btn" data-index="${index}">Edit</button>
                        ${!isLastAdmin ? `<button class="delete-btn" data-index="${index}">Delete</button>` : ''}
                    `;
                    
                    row.appendChild(usernameCell);
                    row.appendChild(fullNameCell);
                    row.appendChild(userTypeCell);
                    row.appendChild(statusCell);
                    row.appendChild(lastLoginCell);
                    row.appendChild(actionsCell);
                    
                    usersTableBody.appendChild(row);
                });
                
                // Update user count
                totalUsersElement.textContent = userData.length;
                
                // Update user type summary
                updateUserTypeSummary();
                
                // Add event listeners to edit buttons
                document.querySelectorAll('#usersTable .edit-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        editUser(index);
                    });
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('#usersTable .delete-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        deleteUser(index);
                    });
                });
                
                // Save data after any update
                saveData();
            }
            
            // Format date for display
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            }
            
            // Show form for adding new employee
            addEmployeeBtn.addEventListener('click', function() {
                formTitle.textContent = 'Add New Employee';
                employeeDataForm.reset();
                employeeStatusInput.value = 'ACTIVE';
                currentPositionInput.value = '';
                employmentStatusInput.value = 'Regular';
                otherPositionInput.style.display = 'none';
                otherPositionInput.required = false;
                editIndexInput.value = '';
                employeeForm.classList.add('active');
            });
            
            // Cancel employee form
            cancelEmployeeBtn.addEventListener('click', function() {
                employeeForm.classList.remove('active');
            });
            
            // Handle employee form submission
            employeeDataForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const employeeData = {
                    name: employeeNameInput.value,
                    id: employeeIdInput.value,
                    dateHired: dateHiredInput.value,
                    status: employeeStatusInput.value,
                    position: currentPositionInput.value,
                    employmentStatus: employmentStatusInput.value
                };
                
                // Handle "Others" position
                if (currentPositionInput.value === 'Others' && otherPositionInput.value.trim() !== '') {
                    employeeData.positionOther = otherPositionInput.value.trim();
                }
                
                const editIndex = editIndexInput.value;
                
                if (editIndex === '') {
                    // Add new employee
                    personnelData.push(employeeData);
                } else {
                    // Update existing employee
                    personnelData[parseInt(editIndex)] = employeeData;
                }
                
                updatePersonnelTable();
                employeeForm.classList.remove('active');
            });
            
            // Edit employee
            function editEmployee(index) {
                const employee = personnelData[index];
                
                formTitle.textContent = 'Edit Employee';
                employeeNameInput.value = employee.name;
                employeeIdInput.value = employee.id;
                dateHiredInput.value = employee.dateHired;
                employeeStatusInput.value = employee.status;
                currentPositionInput.value = employee.position;
                employmentStatusInput.value = employee.employmentStatus;
                
                // Handle "Others" position
                if (employee.position === 'Others' && employee.positionOther) {
                    otherPositionInput.value = employee.positionOther;
                    otherPositionInput.style.display = 'block';
                    otherPositionInput.required = true;
                } else {
                    otherPositionInput.style.display = 'none';
                    otherPositionInput.required = false;
                }
                
                editIndexInput.value = index;
                
                employeeForm.classList.add('active');
            }
            
            // Delete employee
            function deleteEmployee(index) {
                if (confirm('Are you sure you want to delete this employee record?')) {
                    personnelData.splice(index, 1);
                    updatePersonnelTable();
                }
            }
            
            // Show form for adding new user
            addUserBtn.addEventListener('click', function() {
                userFormTitle.textContent = 'Create New User Account';
                userDataForm.reset();
                userTypeInput.value = 'staff';
                userStatusInput.value = 'active';
                userEditIndexInput.value = '';
                userForm.classList.add('active');
            });
            
            // Cancel user form
            cancelUserBtn.addEventListener('click', function() {
                userForm.classList.remove('active');
            });
            
            // Handle user form submission
            userDataForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Check if passwords match
                if (passwordInput.value !== confirmPasswordInput.value) {
                    alert('Passwords do not match!');
                    return;
                }
                
                // Check if username already exists (for new users)
                const editIndex = userEditIndexInput.value;
                if (editIndex === '') {
                    const existingUser = userData.find(user => user.username === usernameInput.value);
                    if (existingUser) {
                        alert('Username already exists! Please choose a different username.');
                        return;
                    }
                }
                
                const userDataObj = {
                    username: usernameInput.value,
                    fullName: fullNameInput.value,
                    password: passwordInput.value, // In a real app, this would be hashed
                    userType: userTypeInput.value,
                    status: userStatusInput.value,
                    lastLogin: null
                };
                
                if (editIndex === '') {
                    // Add new user
                    userData.push(userDataObj);
                } else {
                    // Update existing user - preserve password if not changed
                    if (passwordInput.value === '') {
                        userDataObj.password = userData[parseInt(editIndex)].password;
                    }
                    userData[parseInt(editIndex)] = userDataObj;
                }
                
                updateUsersTable();
                userForm.classList.remove('active');
            });
            
            // Edit user
            function editUser(index) {
                const user = userData[index];
                
                userFormTitle.textContent = 'Edit User Account';
                usernameInput.value = user.username;
                fullNameInput.value = user.fullName;
                passwordInput.value = '';
                confirmPasswordInput.value = '';
                userTypeInput.value = user.userType;
                userStatusInput.value = user.status;
                
                userEditIndexInput.value = index;
                
                userForm.classList.add('active');
            }
            
            // Delete user
            function deleteUser(index) {
                if (confirm('Are you sure you want to delete this user account?')) {
                    userData.splice(index, 1);
                    updateUsersTable();
                }
            }
            
            // Initialize the tables
            updatePersonnelTable();
            updateUsersTable();
        });
    </script>
</body>
</html>